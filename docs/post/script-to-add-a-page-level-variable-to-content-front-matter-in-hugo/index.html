<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="alternate" href="/index.xml" type="application/rss+xml" title="Elib">
		<link rel="icon" href="https://elib.orekiyuta.cn/favicon.ico">
		<title>Script to add a page-level variable to content front matter in hugo - Elib</title>
		
		<link rel="stylesheet" href="https://elib.orekiyuta.cn/css/highlight/github.css">
		<link rel="stylesheet" href="https://elib.orekiyuta.cn/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://elib.orekiyuta.cn/css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="https://elib.orekiyuta.cn/css/theme.css">
		<link rel="stylesheet" href="https://elib.orekiyuta.cn/css/bootie-docs.css">
		<link rel="stylesheet" href="https://elib.orekiyuta.cn/css/site.css">
	</head>

<body role="document">

	
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="https://elib.orekiyuta.cn/">Elib</a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					
			
			
				
					<li ><a href="/post/">Posts</a></li>
				
					<li ><a href="/tags/">Tags</a></li>
				
			
				
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Categories<span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
						
							<li><a href="https://elib.orekiyuta.cn/categories/snap">Snap</a></li>
						
							<li><a href="https://elib.orekiyuta.cn/categories/ubantu">Ubantu</a></li>
						
						</ul>
					</li>
				
				</ul>
				
				<form class="navbar-form navbar-left" role="search" action="https://www.google.co.jp/search" method="get">
					<div class="input-group doc-search-form">
						<input type="hidden" name="as_sitesearch" value="https://elib.orekiyuta.cn">
						<input type="text" name="as_q" class="search-query doc-search-input-text" placeholder="Search">
						<span class="input-group-addon input-group-btn doc-search-input-btn">
							<button class="btn" type="submit"><span class="glyphicon glyphicon-search"></span></button>
						</span>
					</div>
				</form>
				
			</div>
		</div>
	</nav>

<div class="container">


<div class="row">
	<div class="col-sm-8 doc-main">
		<main role="main">
			<article>
				<a id="title"></a>
				<h1 class="doc-entry-title">Script to add a page-level variable to content front matter in hugo</h1>
				<div class="doc-entry-meta">
					<span><time datetime="2018-10-10">October 10, 2018</time></span>
				</div>
				<section>
					<p>This was originally a question posed on the <a href="https://discourse.gohugo.io/t/set-frontmatter-params-in-list-template/14645">hugo discussion forums</a>.</p>
<p>The user wanted to loop through all her content files and add a <code>weight</code> page-level variable to the front matter. The value of <code>weight</code> needed to be the first 2 characters of the content filename, since her content was named like <code>01_content.md</code>, <code>02_content.md</code>, etc.</p>
<p>She then wanted to <code>range</code> through her pages by their weight, like so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">{{ <span style="color:#66d9ef">range</span> .<span style="color:#a6e22e">Pages</span>.<span style="color:#a6e22e">ByWeight</span> }}
&lt;!<span style="color:#f92672">--</span> <span style="color:#a6e22e">some</span> <span style="color:#a6e22e">code</span> <span style="color:#f92672">--</span>&gt;
{{ <span style="color:#a6e22e">end</span> }}
</code></pre></div><h2 id="the-script">The script</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">for</span> file in *.md; <span style="color:#66d9ef">do</span>
    weight<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>file:0:2<span style="color:#e6db74">}</span>
    awk -v weight<span style="color:#f92672">=</span>$weight <span style="color:#e6db74">&#39;/---/{
</span><span style="color:#e6db74">        count++
</span><span style="color:#e6db74">        if(count == 2){
</span><span style="color:#e6db74">        sub(&#34;---&#34;,&#34;weight: &#34; weight &#34;\n---&#34;,$0)
</span><span style="color:#e6db74">        }
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">    {print}&#39;</span> $file &gt; tmp <span style="color:#f92672">&amp;&amp;</span> mv tmp $file
<span style="color:#66d9ef">done</span>
</code></pre></div><h2 id="explained">Explained</h2>
<p>Loop through all files in the directory with extension <code>.md</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">for</span> file in *.md; <span style="color:#66d9ef">do</span>
    <span style="color:#75715e"># ...</span>
<span style="color:#66d9ef">done</span>
</code></pre></div><p>Set a variable using the first 2 characters of the filename:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">weight<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>file:0:2<span style="color:#e6db74">}</span>
</code></pre></div><p>Call an <code>awk</code> program and pass it a <code>weight</code> variable:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">awk -v weight<span style="color:#f92672">=</span>$weight
</code></pre></div><p>When the <code>awk</code> program encounters the 2nd occurrence of <code>---</code> (which is how you end front matter in YAML), it inserts the <code>weight</code> page-level variable on the line above:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#e6db74">&#39;/---/{
</span><span style="color:#e6db74">    count++
</span><span style="color:#e6db74">    if(count == 2){
</span><span style="color:#e6db74">    sub(&#34;---&#34;,&#34;weight: &#34; weight &#34;\n---&#34;,$0)
</span><span style="color:#e6db74">    }
</span><span style="color:#e6db74">}
</span><span style="color:#e6db74">{print}&#39;</span>
</code></pre></div><p>Redirect the output of the <code>awk</code> program to a tmp file, then overwrite the original content file with the tmp file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; tmp <span style="color:#f92672">&amp;&amp;</span> mv tmp $file
</code></pre></div><h2 id="result">Result</h2>
<p>Original <code>01_content.md</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">--<span style="color:#e6db74">-</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">title: &#34;Some title&#34;</span>
draft: <span style="color:#66d9ef">false</span>
--<span style="color:#e6db74">-</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74"></span></code></pre></div><p>Updated <code>01_content.md</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">--<span style="color:#e6db74">-</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">title: &#34;Some title&#34;</span>
draft: <span style="color:#66d9ef">false</span>
weight: <span style="color:#ae81ff">01</span>
--<span style="color:#e6db74">-</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74"></span></code></pre></div>
				</section>
			</article>
		</main>
	</div> 

	

<div class="col-sm-3 col-sm-offset-1 doc-sidebar">
	<div id="sidebar">
	<div class="sidebar-module">
		<div class="sidebar-toc">
			<h4 class="sidebar-heading">Table of Contents</h4>
			<ul>
				<li><strong><a href="#title">Script to add a page-level variable to content front matter in hugo</a></strong></li>
			</ul>
			<nav id="TableOfContents">
  <ul>
    <li><a href="#the-script">The script</a></li>
    <li><a href="#explained">Explained</a></li>
    <li><a href="#result">Result</a></li>
  </ul>
</nav>
		</div>
	</div>
	<div class="sidebar-module">
		<h4 class="sidebar-heading">Pages in Categories</h4>
		<ul class="sidebar-category-list">
		
			<li>
				<a href="https://elib.orekiyuta.cn/categories/snap">
					<span class="doc-list-category">Snap</span>
				</a>
				<ul>
					<li><a href="/post/creating-a-new-theme/">Creating a New Theme</a>
					</li>
				
				</ul>
			</li>
		
			<li>
				<a href="https://elib.orekiyuta.cn/categories/ubantu">
					<span class="doc-list-category">Ubantu</span>
				</a>
				<ul>
					<li><a href="/post/creating-a-new-theme/">Creating a New Theme</a>
					</li>
				
				</ul>
			</li>
		
		</ul>
	</div>
	<div class="sidebar-module">
		<h4 class="sidebar-heading">Tags</h4>
		<div class="tag-box">
		
			<a class="tag-item" href="https://elib.orekiyuta.cn/tags/awk">awk</a>
		
			<a class="tag-item" href="https://elib.orekiyuta.cn/tags/command-line">command-line</a>
		
			<a class="tag-item" href="https://elib.orekiyuta.cn/tags/fedora">fedora</a>
		
			<a class="tag-item" href="https://elib.orekiyuta.cn/tags/fun">fun</a>
		
			<a class="tag-item" href="https://elib.orekiyuta.cn/tags/git">git</a>
		
			<a class="tag-item" href="https://elib.orekiyuta.cn/tags/go">go</a>
		
			<a class="tag-item" href="https://elib.orekiyuta.cn/tags/hugo">hugo</a>
		
			<a class="tag-item" href="https://elib.orekiyuta.cn/tags/jekyll">jekyll</a>
		
			<a class="tag-item" href="https://elib.orekiyuta.cn/tags/migration">migration</a>
		
			<a class="tag-item" href="https://elib.orekiyuta.cn/tags/snap">snap</a>
		
			<a class="tag-item" href="https://elib.orekiyuta.cn/tags/templates">templates</a>
		
			<a class="tag-item" href="https://elib.orekiyuta.cn/tags/theme">theme</a>
		
			<a class="tag-item" href="https://elib.orekiyuta.cn/tags/ubuntu">ubuntu</a>
		
		</div>
	</div>
	</div>
</div>

</div> 


<hr />

<div class="row">
	<div class="col-sm-8">
		<p class="doc-footer-em"><a href="#" onclick="resetSidebarPos()">Back to TOP</a></p>
	</div>
</div>

</div> 

<footer class="doc-footer">
	
	<p>Some articles which I think it nice / Collection Library -- Elias</p>
</footer>



<script src="https://elib.orekiyuta.cn/js/jquery.min.js"></script>
<script src="https://elib.orekiyuta.cn/js/bootstrap.min.js"></script>

<script src="https://elib.orekiyuta.cn/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="https://elib.orekiyuta.cn/js/ie10-viewport-bug-workaround.js"></script>
<script src="https://elib.orekiyuta.cn/js/bootie-docs.js"></script>

</body>
</html>
